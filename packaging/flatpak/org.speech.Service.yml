app-id: org.speech.Service
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: speechd-ng
finish-args:
  # D-Bus Service Export
  - --socket=session-bus
  - --own-name=org.speech.Service
  
  # Network (Ollama, Piper downloads)
  - --share=network
  
  # Audio
  - --socket=pulseaudio
  
  # Data Persistence
  - --filesystem=xdg-data/speechd-ng:create
  - --filesystem=xdg-config/speechd-ng:create

modules:
  - name: speechd-ng
    buildsystem: simple
    build-commands:
      - install -Dm755 speechd-ng /app/bin/speechd-ng
      - install -Dm755 wakeword_bridge.py /app/lib/speechd-ng/wakeword_bridge.py
      - install -Dm755 wyoming_bridge.py /app/lib/speechd-ng/wyoming_bridge.py
    sources:
      - type: file
        path: ../../target/release/speechd-ng
      - type: file
        path: ../../src/wakeword_bridge.py
      - type: file
        path: ../../src/wyoming_bridge.py
